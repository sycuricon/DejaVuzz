# Experiment E2

Experiment E2 is used to compute the trainning overhead of DejaVuzz and SpecDoctor for triggering transient execution window.

## Setup

1. download dataset to exp2-trigger/trigger_dataset path.

```
TODO:
```

## Directory Hierarchy of Dataset

`trigger_dataset` is the dataset of testcase generated by 5 group experiments listed in Table3. The final directory hierarchy of the `trigger_dataset` is as follows:

```
.
├── dejavuzz
│   ├── BOOM_random_trigger_test_00
│   ├── BOOM_random_trigger_test_01
│   ├── ......
│   ├── BOOM_trigger_test_00
│   ├── BOOM_trigger_test_01
│   ├── ......
│   ├── XiangShan_random_trigger_test_00
│   ├── XiangShan_random_trigger_test_01
│   ├── ......
│   ├── XiangShan_trigger_test_00
│   ├── XiangShan_trigger_test_01
│   ├── ......
|   └── XiangShan_trigger_test_09
└── specdoctor
    ├── S2M_ATTACKER
    ├── S2M_VICTIM
    ├── S2M_VICTIM_2
    ├── U2M_ATTACKER
    ├── U2S_ATTACKER
    ├── U2S_VICTIM
    └── U2S_VICTIM_2
```

* `dejavuzz/BOOM_trigger_test*` are the trigger testcase set of `BOOM Dejavuzz`
* `dejavuzz/BOOM_random_trigger_test*` are the trigger testcase set of `BOOM Dejavuzz*`
* `specdoctor/*` are the trigger testcase set of `BOOM SpecDoctor`
* `dejavuzz/XiangShan_trigger_test*` are the trigger testcase set of `XiangShan Dejavuzz`
* `dejavuzz/XiangShan_random_trigger_test*` are the trigger testcase set of `XiangShan Dejavuzz*`

## Execute experiment

1. run `python dejavuzz_trigger_statistic.py` to statstic the trainning overhead of `BOOM DejaVuzz`, `BOOM DejaVuzz*`, `XiangShan DejaVuzz`, `XiangShan DejaVuzz*`. 

```
$ python dejavuzz_trigger_statistic.py 
BOOM_trigger_test:
load/store access fault:        ave_line_num:0.0        ave_valid_num:0.0
load/store page fault:  ave_line_num:0.0        ave_valid_num:0.0
load/store misalign:    ave_line_num:0.0        ave_valid_num:0.0
illegal instruction:    ave_line_num:*  ave_valid_num:*
memory  disambiguation: ave_line_num:0.0        ave_valid_num:0.0
branch mispredict:      ave_line_num:19.4       ave_valid_num:0.9
indirect jump mispredict:       ave_line_num:85.7       ave_valid_num:2.8
return address mispredict:      ave_line_num:85.6       ave_valid_num:2.7

BOOM_random_trigger_test:
...

XiangShan_trigger_test:
...

XiangShan_random_trigger_test:
...

```

`BOOM DejaVuzz`, `BOOM DejaVuzz*`, `XiangShan DejaVuzz`, `XiangShan DejaVuzz*` are corresponding to `BOOM_trigger_test`, `BOOM_random_trigger_test`, `XiangShan_trigger_test` and `XiangShan_trigger_test` in output of script. `ave_line_num` and `ave_valid_num` are corresponding to the TO and ETO in Table 3.

2. run `python specdoctor_trigger_statistic.py` to statstic the trainning overhead of SpecDoctor.

```
$ python specdoctor_trigger_statstic.py 
page-fault: 17833, 2243508, 125.80653843997084
branch: 89107, 11173467, 125.39381866744476
jump: 6217, 777227, 125.01640662699052
Mem-Reorder: 8871, 1098528, 123.83361515049036
```

`page-fault`, `branch`, `jump`, `Mem-Reorder` are corresponding to `Load/Store Page Fault`, `Branch Mispredict`, `Indirect Jump Mispredict`, `Memory Disambiguation`. The third number in each line is both TO and ETO in Table 3. 

## Execute one Testcase
If you want to execute the testcase in trigger_dataset, please execute the following command to replace the file path in dataset's swap_mem.cfg with correct absolute path.
```sh
python trigger_replace_path.py
```

Then you can execute the testcase in exp1-case directory. The command is instructed in `Execute one Testcase` in exp1-case's README. The STARSHIP_TESTCASE should be set as the abspath of the swap_mem.cfg of the target testcase.






